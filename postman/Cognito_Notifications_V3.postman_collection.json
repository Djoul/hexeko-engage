{
	"info": {
		"_postman_id": "cognito-notifications-v3",
		"name": "Cognito Notifications V3",
		"description": "Collection pour tester les endpoints Cognito Notifications avec authentification HMAC, throttling granulaire et audit chiffré.\n\n## Configuration\n\n1. Créer un environnement Postman avec les variables suivantes:\n   - `base_url`: http://localhost:1310\n   - `webhook_secret`: votre-secret-webhook (même que COGNITO_WEBHOOK_SECRET dans .env)\n\n2. Les signatures HMAC sont générées automatiquement dans les pre-request scripts\n\n## Features\n\n- ✅ Authentification HMAC avec X-Cognito-Signature et X-Cognito-Timestamp\n- ✅ Throttling granulaire: SMS (10/min), Email (5/min)\n- ✅ Audit log avec données chiffrées\n- ✅ Support multi-locale (fr-FR, en-GB, de-DE, es-ES, it-IT, nl-NL, pt-PT)\n- ✅ Gestion des triggers Cognito (SignUp, ForgotPassword, ConfirmSignUp, etc.)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Notifications",
			"item": [
				{
					"name": "Send SMS - Valid Request",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Simple HMAC-SHA256 (no dependencies, tested implementation)",
									"const webhookSecret = pm.environment.get('webhook_secret');",
									"if (!webhookSecret) throw new Error('webhook_secret not set');",
									"",
									"const payload = pm.request.body.raw || '';",
									"const timestamp = Math.floor(Date.now() / 1000).toString();",
									"const message = timestamp + payload;",
									"",
									"// SHA-256 implementation by Paul Johnston",
									"function sha256(s) {",
									"    function safe_add(x, y) {",
									"        var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"        return (msw << 16) | (lsw & 0xFFFF);",
									"    }",
									"    ",
									"    function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"    function R(X, n) { return (X >>> n); }",
									"    function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"    function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"    function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"    function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"    function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"    function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"    ",
									"    return binb2hex(core_sha256(str2binb(s), s.length * 8));",
									"}",
									"",
									"function hmac_sha256(key, data) {",
									"    var bkey = str2binb(key);",
									"    if (bkey.length > 16) bkey = core_sha256(bkey, key.length * 8);",
									"    ",
									"    var ipad = Array(16), opad = Array(16);",
									"    for (var i = 0; i < 16; i++) {",
									"        ipad[i] = bkey[i] ^ 0x36363636;",
									"        opad[i] = bkey[i] ^ 0x5C5C5C5C;",
									"    }",
									"    ",
									"    var hash = core_sha256(ipad.concat(str2binb(data)), 512 + data.length * 8);",
									"    return binb2hex(core_sha256(opad.concat(hash), 512 + 256));",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        function safe_add(x, y) {",
									"            var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"            var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"            return (msw << 16) | (lsw & 0xFFFF);",
									"        }",
									"        ",
									"        function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"        function R(X, n) { return (X >>> n); }",
									"        function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"        function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"        function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"        function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"        function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"        function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"}",
									"",
									"const signature = hmac_sha256(webhookSecret, message);",
									"",
									"pm.environment.set('current_timestamp', timestamp);",
									"pm.environment.set('current_signature', signature);",
									"",
									"console.log('✓ Signature generated');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success message', function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include('queued');",
									"});",
									"",
									"pm.test('Response has audit_log_id', function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('audit_log_id');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "{{current_signature}}"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{current_timestamp}}"
							},
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"user@example.com\",\n    \"code\": \"123456\",\n    \"trigger_source\": \"CustomSMSLambda_SignUp\",\n    \"locale\": \"fr-FR\",\n    \"sub\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/cognito-notifications/send-sms",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"cognito-notifications",
								"send-sms"
							]
						},
						"description": "Envoie un SMS de notification Cognito avec authentification HMAC.\n\n**Throttling**: 10 requêtes/minute par identifiant\n\n**Triggers supportés**:\n- CustomSMSLambda_SignUp\n- CustomSMSLambda_SignIn\n- CustomSMSLambda_Authentication\n- CustomSMSLambda_ResendCode"
					},
					"response": []
				},
				{
					"name": "Send SMS - Phone Number",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Simple HMAC-SHA256 (no dependencies, tested implementation)",
									"const webhookSecret = pm.environment.get('webhook_secret');",
									"if (!webhookSecret) throw new Error('webhook_secret not set');",
									"",
									"const payload = pm.request.body.raw || '';",
									"const timestamp = Math.floor(Date.now() / 1000).toString();",
									"const message = timestamp + payload;",
									"",
									"// SHA-256 implementation by Paul Johnston",
									"function sha256(s) {",
									"    function safe_add(x, y) {",
									"        var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"        return (msw << 16) | (lsw & 0xFFFF);",
									"    }",
									"    ",
									"    function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"    function R(X, n) { return (X >>> n); }",
									"    function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"    function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"    function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"    function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"    function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"    function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"    ",
									"    return binb2hex(core_sha256(str2binb(s), s.length * 8));",
									"}",
									"",
									"function hmac_sha256(key, data) {",
									"    var bkey = str2binb(key);",
									"    if (bkey.length > 16) bkey = core_sha256(bkey, key.length * 8);",
									"    ",
									"    var ipad = Array(16), opad = Array(16);",
									"    for (var i = 0; i < 16; i++) {",
									"        ipad[i] = bkey[i] ^ 0x36363636;",
									"        opad[i] = bkey[i] ^ 0x5C5C5C5C;",
									"    }",
									"    ",
									"    var hash = core_sha256(ipad.concat(str2binb(data)), 512 + data.length * 8);",
									"    return binb2hex(core_sha256(opad.concat(hash), 512 + 256));",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        function safe_add(x, y) {",
									"            var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"            var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"            return (msw << 16) | (lsw & 0xFFFF);",
									"        }",
									"        ",
									"        function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"        function R(X, n) { return (X >>> n); }",
									"        function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"        function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"        function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"        function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"        function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"        function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"}",
									"",
									"const signature = hmac_sha256(webhookSecret, message);",
									"",
									"pm.environment.set('current_timestamp', timestamp);",
									"pm.environment.set('current_signature', signature);",
									"",
									"console.log('✓ Signature generated');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "{{current_signature}}"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{current_timestamp}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"phone_number\": \"+33612345678\",\n    \"code\": \"789012\",\n    \"trigger_source\": \"CustomSMSLambda_SignUp\",\n    \"locale\": \"fr-FR\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/cognito-notifications/send-sms",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"cognito-notifications",
								"send-sms"
							]
						},
						"description": "Envoie un SMS avec un numéro de téléphone au lieu d'un email."
					},
					"response": []
				},
				{
					"name": "Send Email - Valid Request",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Simple HMAC-SHA256 (no dependencies, tested implementation)",
									"const webhookSecret = pm.environment.get('webhook_secret');",
									"if (!webhookSecret) throw new Error('webhook_secret not set');",
									"",
									"const payload = pm.request.body.raw || '';",
									"const timestamp = Math.floor(Date.now() / 1000).toString();",
									"const message = timestamp + payload;",
									"",
									"// SHA-256 implementation by Paul Johnston",
									"function sha256(s) {",
									"    function safe_add(x, y) {",
									"        var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"        return (msw << 16) | (lsw & 0xFFFF);",
									"    }",
									"    ",
									"    function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"    function R(X, n) { return (X >>> n); }",
									"    function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"    function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"    function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"    function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"    function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"    function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"    ",
									"    return binb2hex(core_sha256(str2binb(s), s.length * 8));",
									"}",
									"",
									"function hmac_sha256(key, data) {",
									"    var bkey = str2binb(key);",
									"    if (bkey.length > 16) bkey = core_sha256(bkey, key.length * 8);",
									"    ",
									"    var ipad = Array(16), opad = Array(16);",
									"    for (var i = 0; i < 16; i++) {",
									"        ipad[i] = bkey[i] ^ 0x36363636;",
									"        opad[i] = bkey[i] ^ 0x5C5C5C5C;",
									"    }",
									"    ",
									"    var hash = core_sha256(ipad.concat(str2binb(data)), 512 + data.length * 8);",
									"    return binb2hex(core_sha256(opad.concat(hash), 512 + 256));",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        function safe_add(x, y) {",
									"            var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"            var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"            return (msw << 16) | (lsw & 0xFFFF);",
									"        }",
									"        ",
									"        function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"        function R(X, n) { return (X >>> n); }",
									"        function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"        function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"        function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"        function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"        function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"        function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"}",
									"",
									"const signature = hmac_sha256(webhookSecret, message);",
									"",
									"pm.environment.set('current_timestamp', timestamp);",
									"pm.environment.set('current_signature', signature);",
									"",
									"console.log('✓ Signature generated');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('Response has success message', function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include('queued');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "{{current_signature}}"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{current_timestamp}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"user@example.com\",\n    \"code\": \"654321\",\n    \"trigger_source\": \"CustomEmailLambda_ForgotPassword\",\n    \"locale\": \"en-GB\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/cognito-notifications/send-email",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"cognito-notifications",
								"send-email"
							]
						},
						"description": "Envoie un email de notification Cognito avec authentification HMAC.\n\n**Throttling**: 5 requêtes/minute par identifiant\n\n**Triggers supportés**:\n- CustomEmailLambda_SignUp\n- CustomEmailLambda_ForgotPassword\n- CustomEmailLambda_ConfirmSignUp\n- CustomEmailLambda_ResendCode\n- CustomEmailLambda_AdminCreateUser"
					},
					"response": []
				},
				{
					"name": "Send Email - Verification",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Simple HMAC-SHA256 (no dependencies, tested implementation)",
									"const webhookSecret = pm.environment.get('webhook_secret');",
									"if (!webhookSecret) throw new Error('webhook_secret not set');",
									"",
									"const payload = pm.request.body.raw || '';",
									"const timestamp = Math.floor(Date.now() / 1000).toString();",
									"const message = timestamp + payload;",
									"",
									"// SHA-256 implementation by Paul Johnston",
									"function sha256(s) {",
									"    function safe_add(x, y) {",
									"        var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"        return (msw << 16) | (lsw & 0xFFFF);",
									"    }",
									"    ",
									"    function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"    function R(X, n) { return (X >>> n); }",
									"    function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"    function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"    function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"    function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"    function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"    function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"    ",
									"    return binb2hex(core_sha256(str2binb(s), s.length * 8));",
									"}",
									"",
									"function hmac_sha256(key, data) {",
									"    var bkey = str2binb(key);",
									"    if (bkey.length > 16) bkey = core_sha256(bkey, key.length * 8);",
									"    ",
									"    var ipad = Array(16), opad = Array(16);",
									"    for (var i = 0; i < 16; i++) {",
									"        ipad[i] = bkey[i] ^ 0x36363636;",
									"        opad[i] = bkey[i] ^ 0x5C5C5C5C;",
									"    }",
									"    ",
									"    var hash = core_sha256(ipad.concat(str2binb(data)), 512 + data.length * 8);",
									"    return binb2hex(core_sha256(opad.concat(hash), 512 + 256));",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        function safe_add(x, y) {",
									"            var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"            var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"            return (msw << 16) | (lsw & 0xFFFF);",
									"        }",
									"        ",
									"        function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"        function R(X, n) { return (X >>> n); }",
									"        function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"        function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"        function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"        function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"        function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"        function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"}",
									"",
									"const signature = hmac_sha256(webhookSecret, message);",
									"",
									"pm.environment.set('current_timestamp', timestamp);",
									"pm.environment.set('current_signature', signature);",
									"",
									"console.log('✓ Signature generated');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "{{current_signature}}"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{current_timestamp}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"newuser@example.com\",\n    \"code\": \"456789\",\n    \"trigger_source\": \"CustomEmailLambda_ConfirmSignUp\",\n    \"locale\": \"de-DE\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/cognito-notifications/send-email",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"cognito-notifications",
								"send-email"
							]
						},
						"description": "Envoie un email de vérification d'inscription."
					},
					"response": []
				}
			],
			"description": "Endpoints de notification Cognito avec authentification HMAC et throttling granulaire."
		},
		{
			"name": "Webhook",
			"item": [
				{
					"name": "Post-Signup - Invited User to User",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Simple HMAC-SHA256 (no dependencies, tested implementation)",
									"const webhookSecret = pm.environment.get('webhook_secret');",
									"if (!webhookSecret) throw new Error('webhook_secret not set');",
									"",
									"const payload = pm.request.body.raw || '';",
									"const timestamp = Math.floor(Date.now() / 1000).toString();",
									"const message = timestamp + payload;",
									"",
									"// SHA-256 implementation by Paul Johnston",
									"function sha256(s) {",
									"    function safe_add(x, y) {",
									"        var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"        return (msw << 16) | (lsw & 0xFFFF);",
									"    }",
									"    ",
									"    function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"    function R(X, n) { return (X >>> n); }",
									"    function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"    function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"    function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"    function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"    function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"    function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"    ",
									"    return binb2hex(core_sha256(str2binb(s), s.length * 8));",
									"}",
									"",
									"function hmac_sha256(key, data) {",
									"    var bkey = str2binb(key);",
									"    if (bkey.length > 16) bkey = core_sha256(bkey, key.length * 8);",
									"    ",
									"    var ipad = Array(16), opad = Array(16);",
									"    for (var i = 0; i < 16; i++) {",
									"        ipad[i] = bkey[i] ^ 0x36363636;",
									"        opad[i] = bkey[i] ^ 0x5C5C5C5C;",
									"    }",
									"    ",
									"    var hash = core_sha256(ipad.concat(str2binb(data)), 512 + data.length * 8);",
									"    return binb2hex(core_sha256(opad.concat(hash), 512 + 256));",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        function safe_add(x, y) {",
									"            var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"            var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"            return (msw << 16) | (lsw & 0xFFFF);",
									"        }",
									"        ",
									"        function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"        function R(X, n) { return (X >>> n); }",
									"        function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"        function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"        function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"        function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"        function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"        function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"}",
									"",
									"const signature = hmac_sha256(webhookSecret, message);",
									"",
									"pm.environment.set('current_timestamp', timestamp);",
									"pm.environment.set('current_signature', signature);",
									"",
									"console.log('✓ Signature generated');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 200', function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test('User type is USER', function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.user.user_type).to.equal('USER');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "{{current_signature}}"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{current_timestamp}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"version\": \"1\",\n    \"region\": \"eu-west-3\",\n    \"userPoolId\": \"eu-west-3_xxxxx\",\n    \"userName\": \"user@example.com\",\n    \"callerContext\": {\n        \"awsSdkVersion\": \"aws-sdk-unknown-unknown\",\n        \"clientId\": \"xxxxx\"\n    },\n    \"triggerSource\": \"PostConfirmation_ConfirmSignUp\",\n    \"request\": {\n        \"userAttributes\": {\n            \"sub\": \"550e8400-e29b-41d4-a716-446655440000\",\n            \"email_verified\": \"true\",\n            \"cognito:user_status\": \"CONFIRMED\",\n            \"custom:reg_language\": \"fr-FR\",\n            \"email\": \"user@example.com\"\n        }\n    },\n    \"response\": {}\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/webhook/cognito/post-signup",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"webhook",
								"cognito",
								"post-signup"
							]
						},
						"description": "Webhook appelé après l'inscription Cognito. Convertit un InvitedUser en User."
					},
					"response": []
				},
				{
					"name": "Post-Signup - Invited User to Admin",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Simple HMAC-SHA256 (no dependencies, tested implementation)",
									"const webhookSecret = pm.environment.get('webhook_secret');",
									"if (!webhookSecret) throw new Error('webhook_secret not set');",
									"",
									"const payload = pm.request.body.raw || '';",
									"const timestamp = Math.floor(Date.now() / 1000).toString();",
									"const message = timestamp + payload;",
									"",
									"// SHA-256 implementation by Paul Johnston",
									"function sha256(s) {",
									"    function safe_add(x, y) {",
									"        var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"        return (msw << 16) | (lsw & 0xFFFF);",
									"    }",
									"    ",
									"    function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"    function R(X, n) { return (X >>> n); }",
									"    function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"    function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"    function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"    function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"    function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"    function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"    ",
									"    return binb2hex(core_sha256(str2binb(s), s.length * 8));",
									"}",
									"",
									"function hmac_sha256(key, data) {",
									"    var bkey = str2binb(key);",
									"    if (bkey.length > 16) bkey = core_sha256(bkey, key.length * 8);",
									"    ",
									"    var ipad = Array(16), opad = Array(16);",
									"    for (var i = 0; i < 16; i++) {",
									"        ipad[i] = bkey[i] ^ 0x36363636;",
									"        opad[i] = bkey[i] ^ 0x5C5C5C5C;",
									"    }",
									"    ",
									"    var hash = core_sha256(ipad.concat(str2binb(data)), 512 + data.length * 8);",
									"    return binb2hex(core_sha256(opad.concat(hash), 512 + 256));",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        function safe_add(x, y) {",
									"            var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"            var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"            return (msw << 16) | (lsw & 0xFFFF);",
									"        }",
									"        ",
									"        function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"        function R(X, n) { return (X >>> n); }",
									"        function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"        function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"        function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"        function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"        function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"        function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"}",
									"",
									"const signature = hmac_sha256(webhookSecret, message);",
									"",
									"pm.environment.set('current_timestamp', timestamp);",
									"pm.environment.set('current_signature', signature);",
									"",
									"console.log('✓ Signature generated');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "{{current_signature}}"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{current_timestamp}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"version\": \"1\",\n    \"region\": \"eu-west-3\",\n    \"userPoolId\": \"eu-west-3_xxxxx\",\n    \"userName\": \"admin@example.com\",\n    \"callerContext\": {\n        \"awsSdkVersion\": \"aws-sdk-unknown-unknown\",\n        \"clientId\": \"xxxxx\"\n    },\n    \"triggerSource\": \"PostConfirmation_ConfirmSignUp\",\n    \"request\": {\n        \"userAttributes\": {\n            \"sub\": \"550e8400-e29b-41d4-a716-446655440001\",\n            \"email_verified\": \"true\",\n            \"cognito:user_status\": \"CONFIRMED\",\n            \"custom:reg_language\": \"en-GB\",\n            \"custom:invited_role\": \"ADMIN\",\n            \"custom:financer_id\": \"1\",\n            \"email\": \"admin@example.com\"\n        }\n    },\n    \"response\": {}\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/webhook/cognito/post-signup",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"webhook",
								"cognito",
								"post-signup"
							]
						},
						"description": "Webhook pour convertir un InvitedUser en Admin avec association financer."
					},
					"response": []
				}
			],
			"description": "Webhook Cognito pour la conversion post-inscription."
		},
		{
			"name": "Error Cases",
			"item": [
				{
					"name": "Missing HMAC Signature",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 401', function () {",
									"    pm.response.to.have.status(401);",
									"});",
									"",
									"pm.test('Error message mentions signature', function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include('signature');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"user@example.com\",\n    \"code\": \"123456\",\n    \"trigger_source\": \"CustomSMSLambda_SignUp\",\n    \"locale\": \"fr-FR\",\n    \"sub\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/cognito-notifications/send-sms",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"cognito-notifications",
								"send-sms"
							]
						},
						"description": "Test sans signature HMAC - doit retourner 401 Unauthorized."
					},
					"response": []
				},
				{
					"name": "Invalid HMAC Signature",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 403', function () {",
									"    pm.response.to.have.status(403);",
									"});",
									"",
									"pm.test('Error message mentions invalid signature', function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(jsonData.message.toLowerCase()).to.include('invalid');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "invalid-signature-hash"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{$timestamp}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"user@example.com\",\n    \"code\": \"123456\",\n    \"trigger_source\": \"CustomSMSLambda_SignUp\",\n    \"locale\": \"fr-FR\",\n    \"sub\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/cognito-notifications/send-sms",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"cognito-notifications",
								"send-sms"
							]
						},
						"description": "Test avec signature HMAC invalide - doit retourner 403 Forbidden."
					},
					"response": []
				},
				{
					"name": "Throttle Exceeded - SMS",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Simple HMAC-SHA256 (no dependencies, tested implementation)",
									"const webhookSecret = pm.environment.get('webhook_secret');",
									"if (!webhookSecret) throw new Error('webhook_secret not set');",
									"",
									"const payload = pm.request.body.raw || '';",
									"const timestamp = Math.floor(Date.now() / 1000).toString();",
									"const message = timestamp + payload;",
									"",
									"// SHA-256 implementation by Paul Johnston",
									"function sha256(s) {",
									"    function safe_add(x, y) {",
									"        var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"        return (msw << 16) | (lsw & 0xFFFF);",
									"    }",
									"    ",
									"    function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"    function R(X, n) { return (X >>> n); }",
									"    function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"    function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"    function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"    function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"    function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"    function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"    ",
									"    return binb2hex(core_sha256(str2binb(s), s.length * 8));",
									"}",
									"",
									"function hmac_sha256(key, data) {",
									"    var bkey = str2binb(key);",
									"    if (bkey.length > 16) bkey = core_sha256(bkey, key.length * 8);",
									"    ",
									"    var ipad = Array(16), opad = Array(16);",
									"    for (var i = 0; i < 16; i++) {",
									"        ipad[i] = bkey[i] ^ 0x36363636;",
									"        opad[i] = bkey[i] ^ 0x5C5C5C5C;",
									"    }",
									"    ",
									"    var hash = core_sha256(ipad.concat(str2binb(data)), 512 + data.length * 8);",
									"    return binb2hex(core_sha256(opad.concat(hash), 512 + 256));",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        function safe_add(x, y) {",
									"            var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"            var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"            return (msw << 16) | (lsw & 0xFFFF);",
									"        }",
									"        ",
									"        function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"        function R(X, n) { return (X >>> n); }",
									"        function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"        function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"        function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"        function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"        function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"        function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"}",
									"",
									"const signature = hmac_sha256(webhookSecret, message);",
									"",
									"pm.environment.set('current_timestamp', timestamp);",
									"pm.environment.set('current_signature', signature);",
									"",
									"console.log('✓ Signature generated');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"// After 10 requests, this should return 429",
									"if (pm.response.code === 429) {",
									"    pm.test('Throttle limit exceeded', function () {",
									"        pm.response.to.have.status(429);",
									"    });",
									"    ",
									"    pm.test('Has Retry-After header', function () {",
									"        pm.response.to.have.header('Retry-After');",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "{{current_signature}}"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{current_timestamp}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"throttle-test@example.com\",\n    \"code\": \"999999\",\n    \"trigger_source\": \"CustomSMSLambda_SignUp\",\n    \"locale\": \"fr-FR\",\n    \"sub\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/cognito-notifications/send-sms",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"cognito-notifications",
								"send-sms"
							]
						},
						"description": "Test du throttling SMS (10/min). Exécuter cette requête 11 fois rapidement pour déclencher le throttle."
					},
					"response": []
				},
				{
					"name": "Missing Required Field - Email",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Simple HMAC-SHA256 (no dependencies, tested implementation)",
									"const webhookSecret = pm.environment.get('webhook_secret');",
									"if (!webhookSecret) throw new Error('webhook_secret not set');",
									"",
									"const payload = pm.request.body.raw || '';",
									"const timestamp = Math.floor(Date.now() / 1000).toString();",
									"const message = timestamp + payload;",
									"",
									"// SHA-256 implementation by Paul Johnston",
									"function sha256(s) {",
									"    function safe_add(x, y) {",
									"        var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"        return (msw << 16) | (lsw & 0xFFFF);",
									"    }",
									"    ",
									"    function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"    function R(X, n) { return (X >>> n); }",
									"    function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"    function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"    function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"    function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"    function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"    function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"    ",
									"    return binb2hex(core_sha256(str2binb(s), s.length * 8));",
									"}",
									"",
									"function hmac_sha256(key, data) {",
									"    var bkey = str2binb(key);",
									"    if (bkey.length > 16) bkey = core_sha256(bkey, key.length * 8);",
									"    ",
									"    var ipad = Array(16), opad = Array(16);",
									"    for (var i = 0; i < 16; i++) {",
									"        ipad[i] = bkey[i] ^ 0x36363636;",
									"        opad[i] = bkey[i] ^ 0x5C5C5C5C;",
									"    }",
									"    ",
									"    var hash = core_sha256(ipad.concat(str2binb(data)), 512 + data.length * 8);",
									"    return binb2hex(core_sha256(opad.concat(hash), 512 + 256));",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        function safe_add(x, y) {",
									"            var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"            var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"            return (msw << 16) | (lsw & 0xFFFF);",
									"        }",
									"        ",
									"        function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"        function R(X, n) { return (X >>> n); }",
									"        function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"        function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"        function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"        function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"        function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"        function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"}",
									"",
									"const signature = hmac_sha256(webhookSecret, message);",
									"",
									"pm.environment.set('current_timestamp', timestamp);",
									"pm.environment.set('current_signature', signature);",
									"",
									"console.log('✓ Signature generated');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test('Status code is 422', function () {",
									"    pm.response.to.have.status(422);",
									"});",
									"",
									"pm.test('Validation error mentions email', function () {",
									"    const jsonData = pm.response.json();",
									"    pm.expect(JSON.stringify(jsonData)).to.include('email');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "{{current_signature}}"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{current_timestamp}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"code\": \"123456\",\n    \"trigger_source\": \"CustomSMSLambda_SignUp\",\n    \"locale\": \"fr-FR\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/cognito-notifications/send-sms",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"cognito-notifications",
								"send-sms"
							]
						},
						"description": "Test sans email ou phone_number - doit retourner 422 Validation Error."
					},
					"response": []
				}
			],
			"description": "Tests des cas d'erreur: authentification, throttling, validation."
		},
		{
			"name": "Multi-Locale Tests",
			"item": [
				{
					"name": "SMS - French (fr-FR)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Simple HMAC-SHA256 (no dependencies, tested implementation)",
									"const webhookSecret = pm.environment.get('webhook_secret');",
									"if (!webhookSecret) throw new Error('webhook_secret not set');",
									"",
									"const payload = pm.request.body.raw || '';",
									"const timestamp = Math.floor(Date.now() / 1000).toString();",
									"const message = timestamp + payload;",
									"",
									"// SHA-256 implementation by Paul Johnston",
									"function sha256(s) {",
									"    function safe_add(x, y) {",
									"        var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"        return (msw << 16) | (lsw & 0xFFFF);",
									"    }",
									"    ",
									"    function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"    function R(X, n) { return (X >>> n); }",
									"    function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"    function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"    function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"    function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"    function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"    function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"    ",
									"    return binb2hex(core_sha256(str2binb(s), s.length * 8));",
									"}",
									"",
									"function hmac_sha256(key, data) {",
									"    var bkey = str2binb(key);",
									"    if (bkey.length > 16) bkey = core_sha256(bkey, key.length * 8);",
									"    ",
									"    var ipad = Array(16), opad = Array(16);",
									"    for (var i = 0; i < 16; i++) {",
									"        ipad[i] = bkey[i] ^ 0x36363636;",
									"        opad[i] = bkey[i] ^ 0x5C5C5C5C;",
									"    }",
									"    ",
									"    var hash = core_sha256(ipad.concat(str2binb(data)), 512 + data.length * 8);",
									"    return binb2hex(core_sha256(opad.concat(hash), 512 + 256));",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        function safe_add(x, y) {",
									"            var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"            var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"            return (msw << 16) | (lsw & 0xFFFF);",
									"        }",
									"        ",
									"        function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"        function R(X, n) { return (X >>> n); }",
									"        function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"        function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"        function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"        function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"        function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"        function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"}",
									"",
									"const signature = hmac_sha256(webhookSecret, message);",
									"",
									"pm.environment.set('current_timestamp', timestamp);",
									"pm.environment.set('current_signature', signature);",
									"",
									"console.log('✓ Signature generated');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "{{current_signature}}"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{current_timestamp}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"user-fr@example.com\",\n    \"code\": \"111111\",\n    \"trigger_source\": \"CustomSMSLambda_SignUp\",\n    \"locale\": \"fr-FR\",\n    \"sub\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/cognito-notifications/send-sms",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"cognito-notifications",
								"send-sms"
							]
						}
					},
					"response": []
				},
				{
					"name": "Email - English (en-GB)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Simple HMAC-SHA256 (no dependencies, tested implementation)",
									"const webhookSecret = pm.environment.get('webhook_secret');",
									"if (!webhookSecret) throw new Error('webhook_secret not set');",
									"",
									"const payload = pm.request.body.raw || '';",
									"const timestamp = Math.floor(Date.now() / 1000).toString();",
									"const message = timestamp + payload;",
									"",
									"// SHA-256 implementation by Paul Johnston",
									"function sha256(s) {",
									"    function safe_add(x, y) {",
									"        var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"        return (msw << 16) | (lsw & 0xFFFF);",
									"    }",
									"    ",
									"    function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"    function R(X, n) { return (X >>> n); }",
									"    function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"    function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"    function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"    function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"    function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"    function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"    ",
									"    return binb2hex(core_sha256(str2binb(s), s.length * 8));",
									"}",
									"",
									"function hmac_sha256(key, data) {",
									"    var bkey = str2binb(key);",
									"    if (bkey.length > 16) bkey = core_sha256(bkey, key.length * 8);",
									"    ",
									"    var ipad = Array(16), opad = Array(16);",
									"    for (var i = 0; i < 16; i++) {",
									"        ipad[i] = bkey[i] ^ 0x36363636;",
									"        opad[i] = bkey[i] ^ 0x5C5C5C5C;",
									"    }",
									"    ",
									"    var hash = core_sha256(ipad.concat(str2binb(data)), 512 + data.length * 8);",
									"    return binb2hex(core_sha256(opad.concat(hash), 512 + 256));",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        function safe_add(x, y) {",
									"            var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"            var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"            return (msw << 16) | (lsw & 0xFFFF);",
									"        }",
									"        ",
									"        function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"        function R(X, n) { return (X >>> n); }",
									"        function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"        function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"        function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"        function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"        function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"        function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"}",
									"",
									"const signature = hmac_sha256(webhookSecret, message);",
									"",
									"pm.environment.set('current_timestamp', timestamp);",
									"pm.environment.set('current_signature', signature);",
									"",
									"console.log('✓ Signature generated');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "{{current_signature}}"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{current_timestamp}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"user-en@example.com\",\n    \"code\": \"222222\",\n    \"trigger_source\": \"CustomEmailLambda_ForgotPassword\",\n    \"locale\": \"en-GB\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/cognito-notifications/send-email",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"cognito-notifications",
								"send-email"
							]
						}
					},
					"response": []
				},
				{
					"name": "Email - German (de-DE)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Simple HMAC-SHA256 (no dependencies, tested implementation)",
									"const webhookSecret = pm.environment.get('webhook_secret');",
									"if (!webhookSecret) throw new Error('webhook_secret not set');",
									"",
									"const payload = pm.request.body.raw || '';",
									"const timestamp = Math.floor(Date.now() / 1000).toString();",
									"const message = timestamp + payload;",
									"",
									"// SHA-256 implementation by Paul Johnston",
									"function sha256(s) {",
									"    function safe_add(x, y) {",
									"        var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"        return (msw << 16) | (lsw & 0xFFFF);",
									"    }",
									"    ",
									"    function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"    function R(X, n) { return (X >>> n); }",
									"    function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"    function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"    function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"    function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"    function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"    function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"    ",
									"    return binb2hex(core_sha256(str2binb(s), s.length * 8));",
									"}",
									"",
									"function hmac_sha256(key, data) {",
									"    var bkey = str2binb(key);",
									"    if (bkey.length > 16) bkey = core_sha256(bkey, key.length * 8);",
									"    ",
									"    var ipad = Array(16), opad = Array(16);",
									"    for (var i = 0; i < 16; i++) {",
									"        ipad[i] = bkey[i] ^ 0x36363636;",
									"        opad[i] = bkey[i] ^ 0x5C5C5C5C;",
									"    }",
									"    ",
									"    var hash = core_sha256(ipad.concat(str2binb(data)), 512 + data.length * 8);",
									"    return binb2hex(core_sha256(opad.concat(hash), 512 + 256));",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        function safe_add(x, y) {",
									"            var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"            var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"            return (msw << 16) | (lsw & 0xFFFF);",
									"        }",
									"        ",
									"        function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"        function R(X, n) { return (X >>> n); }",
									"        function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"        function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"        function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"        function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"        function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"        function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"}",
									"",
									"const signature = hmac_sha256(webhookSecret, message);",
									"",
									"pm.environment.set('current_timestamp', timestamp);",
									"pm.environment.set('current_signature', signature);",
									"",
									"console.log('✓ Signature generated');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "{{current_signature}}"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{current_timestamp}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"user-de@example.com\",\n    \"code\": \"333333\",\n    \"trigger_source\": \"CustomEmailLambda_ConfirmSignUp\",\n    \"locale\": \"de-DE\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/cognito-notifications/send-email",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"cognito-notifications",
								"send-email"
							]
						}
					},
					"response": []
				},
				{
					"name": "Email - Spanish (es-ES)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// Simple HMAC-SHA256 (no dependencies, tested implementation)",
									"const webhookSecret = pm.environment.get('webhook_secret');",
									"if (!webhookSecret) throw new Error('webhook_secret not set');",
									"",
									"const payload = pm.request.body.raw || '';",
									"const timestamp = Math.floor(Date.now() / 1000).toString();",
									"const message = timestamp + payload;",
									"",
									"// SHA-256 implementation by Paul Johnston",
									"function sha256(s) {",
									"    function safe_add(x, y) {",
									"        var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"        var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"        return (msw << 16) | (lsw & 0xFFFF);",
									"    }",
									"    ",
									"    function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"    function R(X, n) { return (X >>> n); }",
									"    function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"    function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"    function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"    function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"    function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"    function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"    ",
									"    return binb2hex(core_sha256(str2binb(s), s.length * 8));",
									"}",
									"",
									"function hmac_sha256(key, data) {",
									"    var bkey = str2binb(key);",
									"    if (bkey.length > 16) bkey = core_sha256(bkey, key.length * 8);",
									"    ",
									"    var ipad = Array(16), opad = Array(16);",
									"    for (var i = 0; i < 16; i++) {",
									"        ipad[i] = bkey[i] ^ 0x36363636;",
									"        opad[i] = bkey[i] ^ 0x5C5C5C5C;",
									"    }",
									"    ",
									"    var hash = core_sha256(ipad.concat(str2binb(data)), 512 + data.length * 8);",
									"    return binb2hex(core_sha256(opad.concat(hash), 512 + 256));",
									"    ",
									"    function str2binb(str) {",
									"        var bin = [];",
									"        var mask = (1 << 8) - 1;",
									"        for (var i = 0; i < str.length * 8; i += 8) {",
									"            bin[i >> 5] |= (str.charCodeAt(i / 8) & mask) << (24 - i % 32);",
									"        }",
									"        return bin;",
									"    }",
									"    ",
									"    function core_sha256(m, l) {",
									"        var K = [0x428A2F98,0x71374491,0xB5C0FBCF,0xE9B5DBA5,0x3956C25B,0x59F111F1,0x923F82A4,0xAB1C5ED5,0xD807AA98,0x12835B01,0x243185BE,0x550C7DC3,0x72BE5D74,0x80DEB1FE,0x9BDC06A7,0xC19BF174,0xE49B69C1,0xEFBE4786,0xFC19DC6,0x240CA1CC,0x2DE92C6F,0x4A7484AA,0x5CB0A9DC,0x76F988DA,0x983E5152,0xA831C66D,0xB00327C8,0xBF597FC7,0xC6E00BF3,0xD5A79147,0x6CA6351,0x14292967,0x27B70A85,0x2E1B2138,0x4D2C6DFC,0x53380D13,0x650A7354,0x766A0ABB,0x81C2C92E,0x92722C85,0xA2BFE8A1,0xA81A664B,0xC24B8B70,0xC76C51A3,0xD192E819,0xD6990624,0xF40E3585,0x106AA070,0x19A4C116,0x1E376C08,0x2748774C,0x34B0BCB5,0x391C0CB3,0x4ED8AA4A,0x5B9CCA4F,0x682E6FF3,0x748F82EE,0x78A5636F,0x84C87814,0x8CC70208,0x90BEFFFA,0xA4506CEB,0xBEF9A3F7,0xC67178F2];",
									"        var HASH = [0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19];",
									"        var W = new Array(64);",
									"        var a, b, c, d, e, f, g, h, i, j;",
									"        var T1, T2;",
									"        ",
									"        m[l >> 5] |= 0x80 << (24 - l % 32);",
									"        m[((l + 64 >> 9) << 4) + 15] = l;",
									"        ",
									"        function safe_add(x, y) {",
									"            var lsw = (x & 0xFFFF) + (y & 0xFFFF);",
									"            var msw = (x >> 16) + (y >> 16) + (lsw >> 16);",
									"            return (msw << 16) | (lsw & 0xFFFF);",
									"        }",
									"        ",
									"        function S(X, n) { return (X >>> n) | (X << (32 - n)); }",
									"        function R(X, n) { return (X >>> n); }",
									"        function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }",
									"        function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }",
									"        function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }",
									"        function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }",
									"        function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }",
									"        function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }",
									"        ",
									"        for (var i = 0; i < m.length; i += 16) {",
									"            a = HASH[0]; b = HASH[1]; c = HASH[2]; d = HASH[3];",
									"            e = HASH[4]; f = HASH[5]; g = HASH[6]; h = HASH[7];",
									"            ",
									"            for (var j = 0; j < 64; j++) {",
									"                if (j < 16) W[j] = m[j + i];",
									"                else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);",
									"                ",
									"                T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);",
									"                T2 = safe_add(Sigma0256(a), Maj(a, b, c));",
									"                ",
									"                h = g; g = f; f = e; e = safe_add(d, T1);",
									"                d = c; c = b; b = a; a = safe_add(T1, T2);",
									"            }",
									"            ",
									"            HASH[0] = safe_add(a, HASH[0]); HASH[1] = safe_add(b, HASH[1]);",
									"            HASH[2] = safe_add(c, HASH[2]); HASH[3] = safe_add(d, HASH[3]);",
									"            HASH[4] = safe_add(e, HASH[4]); HASH[5] = safe_add(f, HASH[5]);",
									"            HASH[6] = safe_add(g, HASH[6]); HASH[7] = safe_add(h, HASH[7]);",
									"        }",
									"        return HASH;",
									"    }",
									"    ",
									"    function binb2hex(binarray) {",
									"        var hex_tab = \"0123456789abcdef\";",
									"        var str = \"\";",
									"        for (var i = 0; i < binarray.length * 4; i++) {",
									"            str += hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8 + 4)) & 0xF) +",
									"                   hex_tab.charAt((binarray[i >> 2] >> ((3 - i % 4) * 8)) & 0xF);",
									"        }",
									"        return str;",
									"    }",
									"}",
									"",
									"const signature = hmac_sha256(webhookSecret, message);",
									"",
									"pm.environment.set('current_timestamp', timestamp);",
									"pm.environment.set('current_signature', signature);",
									"",
									"console.log('✓ Signature generated');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "X-Cognito-Signature",
								"value": "{{current_signature}}"
							},
							{
								"key": "X-Cognito-Timestamp",
								"value": "{{current_timestamp}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"user-es@example.com\",\n    \"code\": \"444444\",\n    \"trigger_source\": \"CustomEmailLambda_ForgotPassword\",\n    \"locale\": \"es-ES\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/v1/cognito-notifications/send-email",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"v1",
								"cognito-notifications",
								"send-email"
							]
						}
					},
					"response": []
				}
			],
			"description": "Tests de toutes les locales supportées: fr-FR, en-GB, de-DE, es-ES, it-IT, nl-NL, pt-PT."
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:1310",
			"type": "string"
		},
		{
			"key": "webhook_secret",
			"value": "your-webhook-secret-here",
			"type": "string"
		}
	]
}